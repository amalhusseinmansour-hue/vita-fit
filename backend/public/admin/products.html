<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }

        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 15px 30px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar h1 { font-size: 24px; }
        .navbar a { color: white; text-decoration: none; margin-left: 20px; }
        .navbar a:hover { text-decoration: underline; }

        .container { max-width: 1400px; margin: 30px auto; padding: 0 20px; }

        .header-actions {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; flex-wrap: wrap; gap: 15px;
        }
        .header-actions h2 { color: #333; }

        .btn {
            padding: 12px 24px; border: none; border-radius: 8px;
            cursor: pointer; font-size: 14px; font-weight: 600;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(102,126,234,0.4); }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-warning { background: #ffc107; color: #333; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }

        .search-box {
            display: flex; gap: 10px; flex-wrap: wrap;
        }
        .search-box input, .search-box select {
            padding: 10px 15px; border: 1px solid #ddd; border-radius: 8px;
            font-size: 14px;
        }
        .search-box input { width: 250px; }

        .section {
            background: white; border-radius: 15px; padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .products-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px; margin-top: 20px;
        }

        .product-card {
            background: #f8f9fa; border-radius: 12px; overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.15); }

        .product-image {
            width: 100%; height: 180px; object-fit: cover;
            background: #e9ecef; display: flex; align-items: center; justify-content: center;
        }
        .product-image img { width: 100%; height: 100%; object-fit: cover; }
        .product-image .no-image { color: #adb5bd; font-size: 48px; }

        .product-info { padding: 15px; }
        .product-info h3 { color: #333; font-size: 16px; margin-bottom: 8px; }
        .product-info .price { color: #667eea; font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .product-info .old-price { color: #999; text-decoration: line-through; font-size: 14px; }
        .product-info .stock { font-size: 13px; margin: 8px 0; }
        .stock.in-stock { color: #28a745; }
        .stock.low-stock { color: #ffc107; }
        .stock.out-of-stock { color: #dc3545; }

        .product-actions { display: flex; gap: 8px; margin-top: 12px; }
        .product-actions button { flex: 1; }

        /* Modal Styles */
        .modal {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 1000;
            justify-content: center; align-items: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white; border-radius: 15px; width: 90%; max-width: 600px;
            max-height: 90vh; overflow-y: auto;
        }
        .modal-header {
            padding: 20px; border-bottom: 1px solid #eee;
            display: flex; justify-content: space-between; align-items: center;
        }
        .modal-header h3 { color: #333; }
        .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: #999; }
        .modal-body { padding: 20px; }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #333; font-weight: 600; }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;
            font-size: 14px; transition: border-color 0.3s;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none; border-color: #667eea;
        }
        .form-group textarea { resize: vertical; min-height: 80px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        .image-upload {
            border: 2px dashed #ddd; border-radius: 8px; padding: 30px;
            text-align: center; cursor: pointer; transition: all 0.3s;
        }
        .image-upload:hover { border-color: #667eea; background: #f8f9fa; }
        .image-upload input { display: none; }
        .image-upload img { max-width: 200px; max-height: 150px; margin-top: 10px; border-radius: 8px; }

        .badge {
            display: inline-block; padding: 4px 10px; border-radius: 12px;
            font-size: 11px; font-weight: 600;
        }
        .badge-success { background: #d4edda; color: #155724; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .badge-danger { background: #f8d7da; color: #721c24; }

        .loading { text-align: center; padding: 40px; color: #666; }
        .empty-state { text-align: center; padding: 60px; color: #999; }
        .empty-state .icon { font-size: 64px; margin-bottom: 20px; }

        .alert {
            padding: 15px; border-radius: 8px; margin-bottom: 20px;
        }
        .alert-success { background: #d4edda; color: #155724; }
        .alert-danger { background: #f8d7da; color: #721c24; }

        .pagination {
            display: flex; justify-content: center; gap: 5px; margin-top: 20px;
        }
        .pagination button {
            padding: 8px 15px; border: 1px solid #ddd; background: white;
            border-radius: 5px; cursor: pointer;
        }
        .pagination button.active { background: #667eea; color: white; border-color: #667eea; }
        .pagination button:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body>
    <nav class="navbar">
        <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h1>
        <div>
            <a href="dashboard">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="orders">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
            <a href="users">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</a>
            <a href="#" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
        </div>
    </nav>

    <div class="container">
        <div id="alertBox"></div>

        <div class="header-actions">
            <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." onkeyup="searchProducts()">
                <select id="categoryFilter" onchange="filterProducts()">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
                </select>
                <button class="btn btn-primary" onclick="openAddModal()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
            </div>
        </div>

        <div class="section">
            <div id="productsContainer" class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</div>
            <div id="pagination" class="pagination"></div>
        </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="productForm" onsubmit="saveProduct(event)">
                    <input type="hidden" id="productId">

                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
                            <input type="text" id="name" required>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (Ø¹Ø±Ø¨ÙŠ)</label>
                            <input type="text" id="name_ar" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Ø§Ù„ÙˆØµÙ (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
                        <textarea id="description"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Ø§Ù„ÙˆØµÙ (Ø¹Ø±Ø¨ÙŠ)</label>
                        <textarea id="description_ar"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ù„Ø³Ø¹Ø± (Ø±.Ø³)</label>
                            <input type="number" id="price" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Ø³Ø¹Ø± Ø§Ù„ØªØ®ÙÙŠØ¶ (Ø±.Ø³)</label>
                            <input type="number" id="sale_price" step="0.01">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©</label>
                            <input type="number" id="quantity" value="0" required>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„ÙØ¦Ø©</label>
                            <select id="category_id" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</label>
                            <input type="text" id="brand">
                        </div>
                        <div class="form-group">
                            <label>Ø±Ù…Ø² Ø§Ù„Ù…Ù†ØªØ¬ (SKU)</label>
                            <input type="text" id="sku">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</label>
                        <div class="image-upload" onclick="document.getElementById('imageInput').click()">
                            <input type="file" id="imageInput" accept="image/*" onchange="previewImage(event)">
                            <div id="imagePreview">
                                <div style="font-size: 40px;">ğŸ“·</div>
                                <p>Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©</p>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="is_featured"> Ù…Ù†ØªØ¬ Ù…Ù…ÙŠØ²
                        </label>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn" style="background: #eee;" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
                        <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Stock Update Modal -->
    <div id="stockModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
                <button class="modal-close" onclick="closeStockModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="stockForm" onsubmit="updateStock(event)">
                    <input type="hidden" id="stockProductId">
                    <p id="stockProductName" style="margin-bottom: 15px; font-weight: bold;"></p>

                    <div class="form-group">
                        <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                        <input type="number" id="stockQuantity" required>
                    </div>

                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</label>
                        <select id="stockAction">
                            <option value="set">ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ…ÙŠØ©</option>
                            <option value="add">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø®Ø²ÙˆÙ†</option>
                            <option value="subtract">Ø®ØµÙ… Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">ØªØ­Ø¯ÙŠØ«</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const API_URL = window.location.origin;
        let token = localStorage.getItem('adminToken');
        let allProducts = [];
        let categories = [];
        let currentPage = 1;
        const itemsPerPage = 12;

        if (!token) {
            window.location.href = 'index';
        }

        function logout() {
            localStorage.removeItem('adminToken');
            localStorage.removeItem('adminUser');
            window.location.href = 'index';
        }

        function showAlert(message, type = 'success') {
            const alertBox = document.getElementById('alertBox');
            alertBox.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => alertBox.innerHTML = '', 3000);
        }

        async function fetchAPI(endpoint, options = {}) {
            const response = await fetch(`${API_URL}/api${endpoint}`, {
                ...options,
                headers: {
                    'Authorization': `Bearer ${token}`,
                    ...(options.headers || {})
                }
            });
            return await response.json();
        }

        async function loadCategories() {
            try {
                const data = await fetchAPI('/categories');
                if (data.success) {
                    categories = data.data;
                    const select = document.getElementById('category_id');
                    const filter = document.getElementById('categoryFilter');

                    categories.forEach(cat => {
                        select.innerHTML += `<option value="${cat.id}">${cat.name_ar || cat.name}</option>`;
                        filter.innerHTML += `<option value="${cat.id}">${cat.name_ar || cat.name}</option>`;
                    });
                }
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        async function loadProducts() {
            try {
                const data = await fetchAPI('/products?limit=100');
                if (data.success) {
                    allProducts = data.data;
                    displayProducts(allProducts);
                }
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('productsContainer').innerHTML =
                    '<div class="empty-state"><div class="icon">âš ï¸</div><p>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p></div>';
            }
        }

        function displayProducts(products) {
            const container = document.getElementById('productsContainer');

            if (products.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“¦</div>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</p>
                        <button class="btn btn-primary" onclick="openAddModal()" style="margin-top: 15px;">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</button>
                    </div>
                `;
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            const startIndex = (currentPage - 1) * itemsPerPage;
            const paginatedProducts = products.slice(startIndex, startIndex + itemsPerPage);

            container.innerHTML = `<div class="products-grid">
                ${paginatedProducts.map(product => `
                    <div class="product-card">
                        <div class="product-image">
                            ${product.image
                                ? `<img src="${API_URL}${product.image}" alt="${product.name}" onerror="this.parentElement.innerHTML='<div class=\\'no-image\\'>ğŸ“·</div>'">`
                                : '<div class="no-image">ğŸ“·</div>'
                            }
                        </div>
                        <div class="product-info">
                            <h3>${product.name_ar || product.name}</h3>
                            <div class="price">
                                ${product.sale_price
                                    ? `<span class="old-price">${product.price} Ø±.Ø³</span> ${product.sale_price} Ø±.Ø³`
                                    : `${product.price} Ø±.Ø³`
                                }
                            </div>
                            <div class="stock ${product.quantity > 10 ? 'in-stock' : product.quantity > 0 ? 'low-stock' : 'out-of-stock'}">
                                ${product.quantity > 10 ? `âœ“ Ù…ØªÙˆÙØ± (${product.quantity})`
                                    : product.quantity > 0 ? `âš  ÙƒÙ…ÙŠØ© Ù‚Ù„ÙŠÙ„Ø© (${product.quantity})`
                                    : 'âœ— ØºÙŠØ± Ù…ØªÙˆÙØ±'}
                            </div>
                            ${product.is_featured ? '<span class="badge badge-warning">Ù…Ù…ÙŠØ²</span>' : ''}
                            <div class="product-actions">
                                <button class="btn btn-sm btn-warning" onclick="openEditModal(${product.id})">ØªØ¹Ø¯ÙŠÙ„</button>
                                <button class="btn btn-sm btn-success" onclick="openStockModal(${product.id}, '${product.name_ar || product.name}', ${product.quantity})">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})">Ø­Ø°Ù</button>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>`;

            // Pagination
            const totalPages = Math.ceil(products.length / itemsPerPage);
            let paginationHTML = '';

            if (totalPages > 1) {
                paginationHTML += `<button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>Ø§Ù„Ø³Ø§Ø¨Ù‚</button>`;
                for (let i = 1; i <= totalPages; i++) {
                    paginationHTML += `<button onclick="changePage(${i})" class="${i === currentPage ? 'active' : ''}">${i}</button>`;
                }
                paginationHTML += `<button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Ø§Ù„ØªØ§Ù„ÙŠ</button>`;
            }
            document.getElementById('pagination').innerHTML = paginationHTML;
        }

        function changePage(page) {
            currentPage = page;
            const filtered = filterProductsList();
            displayProducts(filtered);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function filterProductsList() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;

            return allProducts.filter(product => {
                const matchesSearch = !search ||
                    product.name.toLowerCase().includes(search) ||
                    (product.name_ar && product.name_ar.includes(search));
                const matchesCategory = !category || product.category_id == category;
                return matchesSearch && matchesCategory;
            });
        }

        function searchProducts() {
            currentPage = 1;
            displayProducts(filterProductsList());
        }

        function filterProducts() {
            currentPage = 1;
            displayProducts(filterProductsList());
        }

        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯';
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            document.getElementById('imagePreview').innerHTML = '<div style="font-size: 40px;">ğŸ“·</div><p>Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©</p>';
            document.getElementById('productModal').classList.add('active');
        }

        async function openEditModal(id) {
            const product = allProducts.find(p => p.id === id);
            if (!product) return;

            document.getElementById('modalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬';
            document.getElementById('productId').value = product.id;
            document.getElementById('name').value = product.name || '';
            document.getElementById('name_ar').value = product.name_ar || '';
            document.getElementById('description').value = product.description || '';
            document.getElementById('description_ar').value = product.description_ar || '';
            document.getElementById('price').value = product.price || '';
            document.getElementById('sale_price').value = product.sale_price || '';
            document.getElementById('quantity').value = product.quantity || 0;
            document.getElementById('category_id').value = product.category_id || '';
            document.getElementById('brand').value = product.brand || '';
            document.getElementById('sku').value = product.sku || '';
            document.getElementById('is_featured').checked = product.is_featured;

            if (product.image) {
                document.getElementById('imagePreview').innerHTML = `<img src="${API_URL}${product.image}" alt="Product">`;
            } else {
                document.getElementById('imagePreview').innerHTML = '<div style="font-size: 40px;">ğŸ“·</div><p>Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©</p>';
            }

            document.getElementById('productModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('productModal').classList.remove('active');
        }

        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        }

        async function saveProduct(event) {
            event.preventDefault();

            const productId = document.getElementById('productId').value;
            const formData = new FormData();

            formData.append('name', document.getElementById('name').value);
            formData.append('name_ar', document.getElementById('name_ar').value);
            formData.append('description', document.getElementById('description').value);
            formData.append('description_ar', document.getElementById('description_ar').value);
            formData.append('price', document.getElementById('price').value);
            formData.append('sale_price', document.getElementById('sale_price').value || '');
            formData.append('quantity', document.getElementById('quantity').value);
            formData.append('category_id', document.getElementById('category_id').value);
            formData.append('brand', document.getElementById('brand').value);
            formData.append('sku', document.getElementById('sku').value);
            formData.append('is_featured', document.getElementById('is_featured').checked);

            const imageFile = document.getElementById('imageInput').files[0];
            if (imageFile) {
                formData.append('image', imageFile);
            }

            try {
                const url = productId
                    ? `${API_URL}/api/products/${productId}`
                    : `${API_URL}/api/products`;

                const response = await fetch(url, {
                    method: productId ? 'PUT' : 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showAlert(productId ? 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­' : 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­');
                    closeModal();
                    loadProducts();
                } else {
                    showAlert(data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£', 'danger');
                }
            } catch (error) {
                console.error('Error saving product:', error);
                showAlert('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬', 'danger');
            }
        }

        async function deleteProduct(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;

            try {
                const data = await fetchAPI(`/products/${id}`, { method: 'DELETE' });

                if (data.success) {
                    showAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­');
                    loadProducts();
                } else {
                    showAlert(data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£', 'danger');
                }
            } catch (error) {
                console.error('Error deleting product:', error);
                showAlert('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬', 'danger');
            }
        }

        function openStockModal(id, name, quantity) {
            document.getElementById('stockProductId').value = id;
            document.getElementById('stockProductName').textContent = name;
            document.getElementById('stockQuantity').value = quantity;
            document.getElementById('stockAction').value = 'set';
            document.getElementById('stockModal').classList.add('active');
        }

        function closeStockModal() {
            document.getElementById('stockModal').classList.remove('active');
        }

        async function updateStock(event) {
            event.preventDefault();

            const id = document.getElementById('stockProductId').value;
            const quantity = document.getElementById('stockQuantity').value;
            const action = document.getElementById('stockAction').value;

            try {
                const data = await fetchAPI(`/products/${id}/stock`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ quantity, action })
                });

                if (data.success) {
                    showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ù†Ø¬Ø§Ø­');
                    closeStockModal();
                    loadProducts();
                } else {
                    showAlert(data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£', 'danger');
                }
            } catch (error) {
                console.error('Error updating stock:', error);
                showAlert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', 'danger');
            }
        }

        // Initialize
        loadCategories();
        loadProducts();
    </script>
</body>
</html>
